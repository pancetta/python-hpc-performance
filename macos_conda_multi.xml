<?xml version="1.0" encoding="UTF-8"?>
<jube>

    <!-- Files -->
    <fileset name="files">
      <copy>input.tmpl</copy>
      <copy>main.py</copy>
    </fileset>

    <!-- Substitute -->
    <substituteset name="substitute">
      <!-- Substitute files -->
      <iofile in="input.tmpl" out="input.ini" />
      <!-- Substitute commands -->
      <sub source="#maxtime_per_benchmark#" dest="$maxtime_per_benchmark" />
      <sub source="#maxrounds_per_benchmark#" dest="$maxrounds_per_benchmark" />
      <sub source="#partype#" dest="$partype" />
    </substituteset>

    <benchmark name="macos_conda_corei5_mt" outpath="bench_runs">
        <comment>JUBE file for running the benchmark suite on my Macbook Pro 2018 (multithreaded)</comment>
        <!-- Configuration -->
        <parameterset name="param_set">
          <parameter name="maxtime_per_benchmark">1E-01</parameter>
          <parameter name="maxrounds_per_benchmark">10000</parameter>
          <parameter name="partype">multithreaded</parameter>
          <parameter name="nthreads">1, 2, 4</parameter>
        </parameterset>
         <!-- Operation -->
        <step name="sub_step" shared="shared">
          <use>param_set</use> <!-- use existing parameterset -->
          <use>files</use>        <!-- use existing fileset -->
          <use>substitute</use>   <!-- use existing substituteset -->
          <do>export PYTHONPATH=../../../..:$PYTHONPATH</do>   <!-- shell command -->
          <do>env OMP_NUM_THREADS=$nthreads python main.py --input input.ini</do>   <!-- shell command -->
          <do>cp results.json shared/results_nthreads=${nthreads}.json</do>   <!-- shell command -->
        </step>
    </benchmark>

    <benchmark name="macos_conda_corei5_mpi" outpath="bench_runs">
        <comment>JUBE file for running the benchmark suite on my Macbook Pro 2018 (MPI)</comment>
        <!-- Configuration -->
        <parameterset name="param_set">
          <parameter name="maxtime_per_benchmark">1E-01</parameter>
          <parameter name="maxrounds_per_benchmark">10000</parameter>
          <parameter name="partype">mpi</parameter>
          <parameter name="nranks">1, 2, 4</parameter>
        </parameterset>
         <!-- Operation -->
        <step name="sub_step" shared="shared">
          <use>param_set</use> <!-- use existing parameterset -->
          <use>files</use>        <!-- use existing fileset -->
          <use>substitute</use>   <!-- use existing substituteset -->
          <do>export PYTHONPATH=../../../..:$PYTHONPATH</do>   <!-- shell command -->
          <do>mpirun -np $nranks python main.py --input input.ini</do>    <!-- shell command -->
          <do>cp results.json shared/results_nranks=${nranks}.json</do>   <!-- shell command -->
        </step>
    </benchmark>
</jube>